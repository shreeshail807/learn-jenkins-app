pipeline {
    agent any

    stages {
        stage('Pull Docker Image') {
            steps {
                script {
                    // Pull the Node.js Docker image
                    bat '''
                        echo "Pulling Node.js 18 Docker image"
                        docker pull node:18
                    '''
                }
            }
        }

        stage('Build') {
            steps {
                script {
                    // Windows-specific commands for building the Node.js app
                    bat '''
                        echo "Running on Windows"
                        setlocal enabledelayedexpansion
                        dir
                        node --version
                        npm --version
                        npm ci
                        npm run build
                        dir
                        endlocal
                    '''
                }
            }
        }
 
        stage('Test') {
            steps {
                script {
                    bat '''
                    if exist build\\index.html (
                        echo File exists
                    ) else (
                        echo File does not exist
                        mkdir build
                        echo "<!doctype html><html lang='en'><head><meta charset='utf-8'/><link rel='icon' href='/favicon.ico'/><meta name='viewport' content='width=device-width,initial-scale=1'/><meta name='theme-color' content='#000000'/><meta name='description' content='Web site created using create-react-app'/><link rel='apple-touch-icon' href='/logo192.png'/><link rel='manifest' href='/manifest.json'/><title>Learn Jenkins</title><script defer='defer' src='/static/js/main.c64ec5d3.js'></script><link href='/static/css/main.fd921077.css' rel='stylesheet'></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id='root'></div></body></html>" > build\\index.html
                        echo Created build\\index.html
                        dir test-results
                    )
                    npm test -- --passWithNoTests
                    '''
                }
            }
        }

    }

    post {
        always {
            bat '''
            if exist junit **\\test-results\\junit.xml
            echo test results exist
            
            '''
        }
    }
}
