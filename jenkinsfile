pipeline {
    agent any

    stages {
        stage('Pull Docker Image') {
            steps {
                script {
                    // Pull the Node.js Docker image
                    bat '''
                        echo "Pulling Node.js 18 Docker image"
                        docker pull node:18
                    '''
                }
            }
        }

        stage('Build') {
            steps {
                script {
                    // Windows-specific commands for building the Node.js app
                    bat '''
                        echo "Running on Windows"
                        setlocal enabledelayedexpansion
                        dir
                        node --version
                        npm --version
                        
                        echo "Installing dependencies"
                        npm ci || exit /b 1

                        echo "Building the project"
                        npm run build || exit /b 1
                        
                        echo "Listing directory after build"
                        dir
                        endlocal
                    '''
                }
            }
        }

        stage ('Test') {
            steps {
                bat '''
                if exist build/index.html (
                    echo File exists
                ) else (
                    echo File does not exist
                    exit /b 1
                )
                '''
            }
        }
    }
}
